<!DOCTYPE html>

<html>
<head>
<meta content="text/html; charset=UTF-8" http-equiv="Content-Type">

<title>markdown.kpeg - rdoc-4.2.2 Documentation</title>

<link type="text/css" media="screen" href="../../rdoc.css" rel="stylesheet">

<script type="text/javascript">
  var rdoc_rel_prefix = "../../";
</script>

<script type="text/javascript" charset="utf-8" src="../../js/jquery.js"></script>
<script type="text/javascript" charset="utf-8" src="../../js/navigation.js"></script>
<script type="text/javascript" charset="utf-8" src="../../js/search_index.js"></script>
<script type="text/javascript" charset="utf-8" src="../../js/search.js"></script>
<script type="text/javascript" charset="utf-8" src="../../js/searcher.js"></script>
<script type="text/javascript" charset="utf-8" src="../../js/darkfish.js"></script>


<body class="file">
<nav id="metadata">
  <nav id="home-section" class="section">
  <h3 class="section-header">
    <a href="../../index.html">Home</a>
    <a href="../../table_of_contents.html#classes">Classes</a>
    <a href="../../table_of_contents.html#methods">Methods</a>
  </h3>
</nav>


  <nav id="search-section" class="section project-section" class="initially-hidden">
  <form action="#" method="get" accept-charset="utf-8">
    <h3 class="section-header">
      <input type="text" name="search" placeholder="Search" id="search-field"
             title="Type to search, Up and Down to navigate, Enter to load">
    </h3>
  </form>

  <ul id="search-results" class="initially-hidden"></ul>
</nav>


  

  <div id="project-metadata">
    <nav id="fileindex-section" class="section project-section">
  <h3 class="section-header">Pages</h3>

  <ul>
  
    <li class="file"><a href="../../CONTRIBUTING_rdoc.html">CONTRIBUTING</a>
  
    <li class="file"><a href="../../CVE-2013-0256_rdoc.html">CVE-2013-0256</a>
  
    <li class="file"><a href="../../ExampleMarkdown_md.html">ExampleMarkdown</a>
  
    <li class="file"><a href="../../ExampleRDoc_rdoc.html">ExampleRDoc</a>
  
    <li class="file"><a href="../../History_rdoc.html">History</a>
  
    <li class="file"><a href="../../LEGAL_rdoc.html">LEGAL</a>
  
    <li class="file"><a href="../../LICENSE_rdoc.html">LICENSE</a>
  
    <li class="file"><a href="../../Manifest_txt.html">Manifest</a>
  
    <li class="file"><a href="../../README_rdoc.html">README</a>
  
    <li class="file"><a href="../../RI_rdoc.html">RI</a>
  
    <li class="file"><a href="../../Rakefile.html">Rakefile</a>
  
    <li class="file"><a href="../../TODO_rdoc.html">TODO</a>
  
    <li class="file"><a href="../../lib/rdoc/markdown_kpeg.html">markdown.kpeg</a>
  
    <li class="file"><a href="../../lib/rdoc/markdown/literals_1_8_kpeg.html">literals_1_8.kpeg</a>
  
    <li class="file"><a href="../../lib/rdoc/markdown/literals_1_9_kpeg.html">literals_1_9.kpeg</a>
  
    <li class="file"><a href="../../lib/rdoc/rd/block_parser_ry.html">block_parser.ry</a>
  
    <li class="file"><a href="../../lib/rdoc/rd/inline_parser_ry.html">inline_parser.ry</a>
  
  </ul>
</nav>

    <nav id="classindex-section" class="section project-section">
  <h3 class="section-header">Class and Module Index</h3>

  <ul class="link-list">
  
    <li><a href="../../RDoc.html">RDoc</a>
  
    <li><a href="../../RDoc/Alias.html">RDoc::Alias</a>
  
    <li><a href="../../RDoc/AnonClass.html">RDoc::AnonClass</a>
  
    <li><a href="../../RDoc/AnyMethod.html">RDoc::AnyMethod</a>
  
    <li><a href="../../RDoc/Attr.html">RDoc::Attr</a>
  
    <li><a href="../../RDoc/ClassModule.html">RDoc::ClassModule</a>
  
    <li><a href="../../RDoc/CodeObject.html">RDoc::CodeObject</a>
  
    <li><a href="../../RDoc/Comment.html">RDoc::Comment</a>
  
    <li><a href="../../RDoc/Constant.html">RDoc::Constant</a>
  
    <li><a href="../../RDoc/Context.html">RDoc::Context</a>
  
    <li><a href="../../RDoc/Context/Section.html">RDoc::Context::Section</a>
  
    <li><a href="../../RDoc/CrossReference.html">RDoc::CrossReference</a>
  
    <li><a href="../../RDoc/ERBIO.html">RDoc::ERBIO</a>
  
    <li><a href="../../RDoc/ERBPartial.html">RDoc::ERBPartial</a>
  
    <li><a href="../../RDoc/Encoding.html">RDoc::Encoding</a>
  
    <li><a href="../../RDoc/Error.html">RDoc::Error</a>
  
    <li><a href="../../RDoc/Extend.html">RDoc::Extend</a>
  
    <li><a href="../../RDoc/Gauntlet.html">RDoc::Gauntlet</a>
  
    <li><a href="../../RDoc/Generator.html">RDoc::Generator</a>
  
    <li><a href="../../RDoc/Generator/Darkfish.html">RDoc::Generator::Darkfish</a>
  
    <li><a href="../../RDoc/Generator/JsonIndex.html">RDoc::Generator::JsonIndex</a>
  
    <li><a href="../../RDoc/Generator/Markup.html">RDoc::Generator::Markup</a>
  
    <li><a href="../../RDoc/Generator/POT.html">RDoc::Generator::POT</a>
  
    <li><a href="../../RDoc/Generator/POT/MessageExtractor.html">RDoc::Generator::POT::MessageExtractor</a>
  
    <li><a href="../../RDoc/Generator/POT/PO.html">RDoc::Generator::POT::PO</a>
  
    <li><a href="../../RDoc/Generator/POT/POEntry.html">RDoc::Generator::POT::POEntry</a>
  
    <li><a href="../../RDoc/Generator/RI.html">RDoc::Generator::RI</a>
  
    <li><a href="../../RDoc/GhostMethod.html">RDoc::GhostMethod</a>
  
    <li><a href="../../RDoc/I18n.html">RDoc::I18n</a>
  
    <li><a href="../../RDoc/I18n/Locale.html">RDoc::I18n::Locale</a>
  
    <li><a href="../../RDoc/I18n/Text.html">RDoc::I18n::Text</a>
  
    <li><a href="../../RDoc/Include.html">RDoc::Include</a>
  
    <li><a href="../../RDoc/Markdown.html">RDoc::Markdown</a>
  
    <li><a href="../../RDoc/Markdown/Literals.html">RDoc::Markdown::Literals</a>
  
    <li><a href="../../RDoc/Markup.html">RDoc::Markup</a>
  
    <li><a href="../../RDoc/Markup/AttrChanger.html">RDoc::Markup::AttrChanger</a>
  
    <li><a href="../../RDoc/Markup/AttrSpan.html">RDoc::Markup::AttrSpan</a>
  
    <li><a href="../../RDoc/Markup/AttributeManager.html">RDoc::Markup::AttributeManager</a>
  
    <li><a href="../../RDoc/Markup/Attributes.html">RDoc::Markup::Attributes</a>
  
    <li><a href="../../RDoc/Markup/BlankLine.html">RDoc::Markup::BlankLine</a>
  
    <li><a href="../../RDoc/Markup/BlockQuote.html">RDoc::Markup::BlockQuote</a>
  
    <li><a href="../../RDoc/Markup/Document.html">RDoc::Markup::Document</a>
  
    <li><a href="../../RDoc/Markup/Formatter.html">RDoc::Markup::Formatter</a>
  
    <li><a href="../../RDoc/Markup/FormatterTestCase.html">RDoc::Markup::FormatterTestCase</a>
  
    <li><a href="../../RDoc/Markup/HardBreak.html">RDoc::Markup::HardBreak</a>
  
    <li><a href="../../RDoc/Markup/Include.html">RDoc::Markup::Include</a>
  
    <li><a href="../../RDoc/Markup/IndentedParagraph.html">RDoc::Markup::IndentedParagraph</a>
  
    <li><a href="../../RDoc/Markup/List.html">RDoc::Markup::List</a>
  
    <li><a href="../../RDoc/Markup/ListItem.html">RDoc::Markup::ListItem</a>
  
    <li><a href="../../RDoc/Markup/Paragraph.html">RDoc::Markup::Paragraph</a>
  
    <li><a href="../../RDoc/Markup/Parser.html">RDoc::Markup::Parser</a>
  
    <li><a href="../../RDoc/Markup/Parser/Error.html">RDoc::Markup::Parser::Error</a>
  
    <li><a href="../../RDoc/Markup/Parser/ParseError.html">RDoc::Markup::Parser::ParseError</a>
  
    <li><a href="../../RDoc/Markup/PreProcess.html">RDoc::Markup::PreProcess</a>
  
    <li><a href="../../RDoc/Markup/Raw.html">RDoc::Markup::Raw</a>
  
    <li><a href="../../RDoc/Markup/Rule.html">RDoc::Markup::Rule</a>
  
    <li><a href="../../RDoc/Markup/Special.html">RDoc::Markup::Special</a>
  
    <li><a href="../../RDoc/Markup/TextFormatterTestCase.html">RDoc::Markup::TextFormatterTestCase</a>
  
    <li><a href="../../RDoc/Markup/ToAnsi.html">RDoc::Markup::ToAnsi</a>
  
    <li><a href="../../RDoc/Markup/ToBs.html">RDoc::Markup::ToBs</a>
  
    <li><a href="../../RDoc/Markup/ToHtml.html">RDoc::Markup::ToHtml</a>
  
    <li><a href="../../RDoc/Markup/ToHtmlCrossref.html">RDoc::Markup::ToHtmlCrossref</a>
  
    <li><a href="../../RDoc/Markup/ToHtmlSnippet.html">RDoc::Markup::ToHtmlSnippet</a>
  
    <li><a href="../../RDoc/Markup/ToJoinedParagraph.html">RDoc::Markup::ToJoinedParagraph</a>
  
    <li><a href="../../RDoc/Markup/ToLabel.html">RDoc::Markup::ToLabel</a>
  
    <li><a href="../../RDoc/Markup/ToMarkdown.html">RDoc::Markup::ToMarkdown</a>
  
    <li><a href="../../RDoc/Markup/ToRdoc.html">RDoc::Markup::ToRdoc</a>
  
    <li><a href="../../RDoc/Markup/ToTableOfContents.html">RDoc::Markup::ToTableOfContents</a>
  
    <li><a href="../../RDoc/Markup/ToTest.html">RDoc::Markup::ToTest</a>
  
    <li><a href="../../RDoc/Markup/ToTtOnly.html">RDoc::Markup::ToTtOnly</a>
  
    <li><a href="../../RDoc/Markup/Verbatim.html">RDoc::Markup::Verbatim</a>
  
    <li><a href="../../RDoc/MetaMethod.html">RDoc::MetaMethod</a>
  
    <li><a href="../../RDoc/MethodAttr.html">RDoc::MethodAttr</a>
  
    <li><a href="../../RDoc/Mixin.html">RDoc::Mixin</a>
  
    <li><a href="../../RDoc/NormalClass.html">RDoc::NormalClass</a>
  
    <li><a href="../../RDoc/NormalModule.html">RDoc::NormalModule</a>
  
    <li><a href="../../RDoc/Options.html">RDoc::Options</a>
  
    <li><a href="../../RDoc/Parser.html">RDoc::Parser</a>
  
    <li><a href="../../RDoc/Parser/C.html">RDoc::Parser::C</a>
  
    <li><a href="../../RDoc/Parser/ChangeLog.html">RDoc::Parser::ChangeLog</a>
  
    <li><a href="../../RDoc/Parser/Markdown.html">RDoc::Parser::Markdown</a>
  
    <li><a href="../../RDoc/Parser/RD.html">RDoc::Parser::RD</a>
  
    <li><a href="../../RDoc/Parser/Ruby.html">RDoc::Parser::Ruby</a>
  
    <li><a href="../../RDoc/Parser/RubyTools.html">RDoc::Parser::RubyTools</a>
  
    <li><a href="../../RDoc/Parser/Simple.html">RDoc::Parser::Simple</a>
  
    <li><a href="../../RDoc/Parser/Text.html">RDoc::Parser::Text</a>
  
    <li><a href="../../RDoc/RD.html">RDoc::RD</a>
  
    <li><a href="../../RDoc/RD/BlockParser.html">RDoc::RD::BlockParser</a>
  
    <li><a href="../../RDoc/RD/Inline.html">RDoc::RD::Inline</a>
  
    <li><a href="../../RDoc/RD/InlineParser.html">RDoc::RD::InlineParser</a>
  
    <li><a href="../../RDoc/RDoc.html">RDoc::RDoc</a>
  
    <li><a href="../../RDoc/RI.html">RDoc::RI</a>
  
    <li><a href="../../RDoc/RI/Driver.html">RDoc::RI::Driver</a>
  
    <li><a href="../../RDoc/RI/Driver/Error.html">RDoc::RI::Driver::Error</a>
  
    <li><a href="../../RDoc/RI/Driver/NotFoundError.html">RDoc::RI::Driver::NotFoundError</a>
  
    <li><a href="../../RDoc/RI/Error.html">RDoc::RI::Error</a>
  
    <li><a href="../../RDoc/RI/Formatter.html">RDoc::RI::Formatter</a>
  
    <li><a href="../../RDoc/RI/Paths.html">RDoc::RI::Paths</a>
  
    <li><a href="../../RDoc/Require.html">RDoc::Require</a>
  
    <li><a href="../../RDoc/RubyLex.html">RDoc::RubyLex</a>
  
    <li><a href="../../RDoc/RubyLex/Error.html">RDoc::RubyLex::Error</a>
  
    <li><a href="../../RDoc/RubyToken.html">RDoc::RubyToken</a>
  
    <li><a href="../../RDoc/RubygemsHook.html">RDoc::RubygemsHook</a>
  
    <li><a href="../../RDoc/Servlet.html">RDoc::Servlet</a>
  
    <li><a href="../../RDoc/SingleClass.html">RDoc::SingleClass</a>
  
    <li><a href="../../RDoc/Stats.html">RDoc::Stats</a>
  
    <li><a href="../../RDoc/Stats/Normal.html">RDoc::Stats::Normal</a>
  
    <li><a href="../../RDoc/Stats/Quiet.html">RDoc::Stats::Quiet</a>
  
    <li><a href="../../RDoc/Stats/Verbose.html">RDoc::Stats::Verbose</a>
  
    <li><a href="../../RDoc/Store.html">RDoc::Store</a>
  
    <li><a href="../../RDoc/Store/Error.html">RDoc::Store::Error</a>
  
    <li><a href="../../RDoc/Store/MissingFileError.html">RDoc::Store::MissingFileError</a>
  
    <li><a href="../../RDoc/Task.html">RDoc::Task</a>
  
    <li><a href="../../RDoc/TestCase.html">RDoc::TestCase</a>
  
    <li><a href="../../RDoc/Text.html">RDoc::Text</a>
  
    <li><a href="../../RDoc/TokenStream.html">RDoc::TokenStream</a>
  
    <li><a href="../../RDoc/TomDoc.html">RDoc::TomDoc</a>
  
    <li><a href="../../RDoc/TopLevel.html">RDoc::TopLevel</a>
  
    <li><a href="../../RDocTask.html">RDocTask</a>
  
    <li><a href="../../Test.html">Test</a>
  
  </ul>
</nav>

  </div>
</nav>

<div id="documentation" class="description">
  
<p>%% name = <a href="../../RDoc/Markdown.html">RDoc::Markdown</a></p>

<p>%% header { # coding: UTF-8 # :markup: markdown</p>

<p>## # <a href="../../RDoc/Markdown.html">RDoc::Markdown</a> as described by
the [markdown <a href="http://syntax">syntax]</a>. # # To choose Markdown
as your only default format see # <a
href="../../RDoc/Options.html#label-Saved+Options">Saved Options at
RDoc::Options</a> for instructions on setting up a `.doc_options` # file to
store your project default. # # ## Usage # # Here is a brief example of
using this parse to read a markdown file by hand. # #     data =
File.read(“README.md”) #     formatter = <a
href="../../RDoc/Markup/ToHtml.html#method-c-new">RDoc::Markup::ToHtml.new</a>(RDoc::Options.new,
nil) #     html = <a
href="../../RDoc/Markdown.html#method-c-parse">RDoc::Markdown.parse</a>.accept(@formatter)
# #     # do something with html # # ## Extensions # # The following
markdown extensions are supported by the parser, but not all # are used in
<a href="../../RDoc.html">RDoc</a> output by default. # # ### <a
href="../../RDoc.html">RDoc</a> # # The <a href="../../RDoc.html">RDoc</a>
Markdown parser has the following built-in behaviors that cannot be #
disabled. # # Underscores embedded in words are never interpreted as
emphasis.  (While the # [markdown <a href="http://dingus">dingus]</a>
emphasizes in-word underscores, neither the # Markdown syntax nor
MarkdownTest mention this behavior.) # # For HTML output, <a
href="../../RDoc.html">RDoc</a> always auto-links bare URLs. # # ### Break
on Newline # # The break_on_newline extension converts all newlines into
hard line breaks # as in [Github Flavored <a
href="http://GFM">Markdown]</a>.  This extension is disabled by # default.
# # ### CSS # # The css extension enables CSS blocks to be included in the
output, but they # are not used for any built-in <a
href="../../RDoc.html">RDoc</a> output format.  This extension is disabled
# by default. # # Example: # #     &lt;style type=“text/css”&gt; #     h1 {
font-size: 3em } #     &lt;/style&gt; # # ### Definition Lists # # The
definition_lists extension allows definition lists using the [PHP #
Markdown Extra <a href="http://PHPE">syntax]</a>, but only one label and
definition are supported # at this time.  This extension is enabled by
default. # # Example: # # “` # cat # :   A small furry mammal # that seems
to sleep a lot # # ant # :   A little insect that is known # to enjoy
picnics # # “` # # Produces: # # cat # :   A small furry mammal # that
seems to sleep a lot # # ant # :   A little insect that is known # to enjoy
picnics # # ### Github # # The github extension enables a partial set of
[Github Flavored Markdown] # [GFM].  This extension is enabled by default.
# # Supported github extensions include: # # #### Fenced code blocks # #
Use ` “` ` around a block of code instead of indenting it four spaces. # #
#### Syntax highlighting # # Use ` “` ruby ` as the start of a code fence
to add syntax highlighting. # (Currently only `ruby` syntax is supported).
# # ### HTML # # Enables raw HTML to be included in the output.  This
extension is enabled by # default. # # Example: # #     &lt;table&gt; #    
… #     &lt;/table&gt; # # ### Notes # # The notes extension enables
footnote support.  This extension is enabled by # default. # # Example: # #
Here is some <a href="http://^1">text</a> including an inline footnote
^[for short footnotes] # #     … # #     [^1]: With the footnote text down
at the bottom # # Produces: # # Here is some <a href="http://^1">text</a>
including an inline footnote ^[for short footnotes] # # [^1]: With the
footnote text down at the bottom # # ## Limitations # # * Link titles are
not used # * Footnotes are collapsed into a single paragraph # # ## Author
# # This markdown parser is a port to kpeg from [<a
href="http://pegmarkdown">peg-markdown]</a> by # John MacFarlane. # # It is
used under the MIT license: # # Permission is hereby granted, free of
charge, to any person obtaining a copy # of this software and associated
documentation files (the “Software”), to deal # in the Software without
restriction, including without limitation the rights # to use, copy,
modify, merge, publish, distribute, sublicense, and/or sell # copies of the
Software, and to permit persons to whom the Software is # furnished to do
so, subject to the following conditions: # # The above copyright notice and
this permission notice shall be included in # all copies or substantial
portions of the Software. # # THE SOFTWARE IS PROVIDED “AS IS”, WITHOUT
WARRANTY OF ANY KIND, EXPRESS OR # IMPLIED, INCLUDING BUT NOT LIMITED TO
THE WARRANTIES OF MERCHANTABILITY, # FITNESS FOR A PARTICULAR PURPOSE AND
NONINFRINGEMENT. IN NO EVENT SHALL THE # AUTHORS OR COPYRIGHT HOLDERS BE
LIABLE FOR ANY CLAIM, DAMAGES OR OTHER # LIABILITY, WHETHER IN AN ACTION OF
CONTRACT, TORT OR OTHERWISE, ARISING FROM, # OUT OF OR IN CONNECTION WITH
THE SOFTWARE OR THE USE OR OTHER DEALINGS IN # THE SOFTWARE. # # The port
to kpeg was performed by Eric Hodel and Evan Phoenix # # [dingus]: <a
href="http://daringfireball.net/projects/markdown/dingus">daringfireball.net/projects/markdown/dingus</a>
# [GFM]: <a
href="http://github.github.com/github-flavored-markdown">github.github.com/github-flavored-markdown</a>/
# [pegmarkdown]: <a
href="https://github.com/jgm/peg-markdown">github.com/jgm/peg-markdown</a>
# [PHPE]: <a
href="http://michelf.com/projects/php-markdown/extra/#def-list">michelf.com/projects/php-markdown/extra/#def-list</a>
# [syntax]: <a
href="http://daringfireball.net/projects/markdown/syntax">daringfireball.net/projects/markdown/syntax</a>
#– # Last updated to jgm/peg-markdown commit 8f8fc22ef0</p>

<p>}</p>

<p>%% {</p>

<pre class="ruby"><span class="ruby-identifier">require</span> <span class="ruby-string">&#39;rubygems&#39;</span>
<span class="ruby-identifier">require</span> <span class="ruby-string">&#39;rdoc&#39;</span>
<span class="ruby-identifier">require</span> <span class="ruby-string">&#39;rdoc/markup/to_joined_paragraph&#39;</span>
<span class="ruby-identifier">require</span> <span class="ruby-string">&#39;rdoc/markdown/entities&#39;</span>

<span class="ruby-keyword">if</span> <span class="ruby-constant">RUBY_VERSION</span> <span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;1.9&#39;</span> <span class="ruby-keyword">then</span>
  <span class="ruby-identifier">require</span> <span class="ruby-string">&#39;rdoc/markdown/literals_1_9&#39;</span>
<span class="ruby-keyword">else</span>
  <span class="ruby-identifier">require</span> <span class="ruby-string">&#39;rdoc/markdown/literals_1_8&#39;</span>
<span class="ruby-keyword">end</span>

<span class="ruby-comment">##</span>
<span class="ruby-comment"># Supported extensions</span>

<span class="ruby-constant">EXTENSIONS</span> = []

<span class="ruby-comment">##</span>
<span class="ruby-comment"># Extensions enabled by default</span>

<span class="ruby-constant">DEFAULT_EXTENSIONS</span> = [
  :<span class="ruby-identifier">definition_lists</span>,
  :<span class="ruby-identifier">github</span>,
  :<span class="ruby-identifier">html</span>,
  :<span class="ruby-identifier">notes</span>,
]

<span class="ruby-comment"># :section: Extensions</span>

<span class="ruby-comment">##</span>
<span class="ruby-comment"># Creates extension methods for the `name` extension to enable and disable</span>
<span class="ruby-comment"># the extension and to query if they are active.</span>

<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">extension</span> <span class="ruby-identifier">name</span>
  <span class="ruby-constant">EXTENSIONS</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">name</span>

  <span class="ruby-identifier">define_method</span> <span class="ruby-node">&quot;#{name}?&quot;</span> <span class="ruby-keyword">do</span>
    <span class="ruby-identifier">extension?</span> <span class="ruby-identifier">name</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">define_method</span> <span class="ruby-node">&quot;#{name}=&quot;</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">enable</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">extension</span> <span class="ruby-identifier">name</span>, <span class="ruby-identifier">enable</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span>

<span class="ruby-comment">##</span>
<span class="ruby-comment"># Converts all newlines into hard breaks</span>

<span class="ruby-identifier">extension</span> :<span class="ruby-identifier">break_on_newline</span>

<span class="ruby-comment">##</span>
<span class="ruby-comment"># Allow style blocks</span>

<span class="ruby-identifier">extension</span> :<span class="ruby-identifier">css</span>

<span class="ruby-comment">##</span>
<span class="ruby-comment"># Allow PHP Markdown Extras style definition lists</span>

<span class="ruby-identifier">extension</span> :<span class="ruby-identifier">definition_lists</span>

<span class="ruby-comment">##</span>
<span class="ruby-comment"># Allow Github Flavored Markdown</span>

<span class="ruby-identifier">extension</span> :<span class="ruby-identifier">github</span>

<span class="ruby-comment">##</span>
<span class="ruby-comment"># Allow HTML</span>

<span class="ruby-identifier">extension</span> :<span class="ruby-identifier">html</span>

<span class="ruby-comment">##</span>
<span class="ruby-comment"># Enables the notes extension</span>

<span class="ruby-identifier">extension</span> :<span class="ruby-identifier">notes</span>

<span class="ruby-comment"># :section: </span>

<span class="ruby-comment">##</span>
<span class="ruby-comment"># Parses the `markdown` document into an RDoc::Document using the default</span>
<span class="ruby-comment"># extensions.</span>

<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">parse</span> <span class="ruby-identifier">markdown</span>
  <span class="ruby-identifier">parser</span> = <span class="ruby-identifier">new</span>

  <span class="ruby-identifier">parser</span>.<span class="ruby-identifier">parse</span> <span class="ruby-identifier">markdown</span>
<span class="ruby-keyword">end</span>

<span class="ruby-comment"># TODO remove when kpeg 0.10 is released</span>
<span class="ruby-keyword">alias</span> <span class="ruby-identifier">orig_initialize</span> <span class="ruby-identifier">initialize</span> <span class="ruby-comment"># :nodoc:</span>

<span class="ruby-comment">##</span>
<span class="ruby-comment"># Creates a new markdown parser that enables the given +extensions+.</span>

<span class="ruby-keyword">def</span> <span class="ruby-identifier">initialize</span> <span class="ruby-identifier">extensions</span> = <span class="ruby-constant">DEFAULT_EXTENSIONS</span>, <span class="ruby-identifier">debug</span> = <span class="ruby-keyword">false</span>
  <span class="ruby-ivar">@debug</span>      = <span class="ruby-identifier">debug</span>
  <span class="ruby-ivar">@formatter</span>  = <span class="ruby-constant">RDoc</span><span class="ruby-operator">::</span><span class="ruby-constant">Markup</span><span class="ruby-operator">::</span><span class="ruby-constant">ToJoinedParagraph</span>.<span class="ruby-identifier">new</span>
  <span class="ruby-ivar">@extensions</span> = <span class="ruby-identifier">extensions</span>

  <span class="ruby-ivar">@references</span>          = <span class="ruby-keyword">nil</span>
  <span class="ruby-ivar">@unlinked_references</span> = <span class="ruby-keyword">nil</span>

  <span class="ruby-ivar">@footnotes</span>       = <span class="ruby-keyword">nil</span>
  <span class="ruby-ivar">@note_order</span>      = <span class="ruby-keyword">nil</span>
<span class="ruby-keyword">end</span>

<span class="ruby-comment">##</span>
<span class="ruby-comment"># Wraps `text` in emphasis for rdoc inline formatting</span>

<span class="ruby-keyword">def</span> <span class="ruby-identifier">emphasis</span> <span class="ruby-identifier">text</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">text</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp">/\A[a-z\d.\/]+\z/</span> <span class="ruby-keyword">then</span>
    <span class="ruby-node">&quot;_#{text}_&quot;</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-node">&quot;&lt;em&gt;#{text}&lt;/em&gt;&quot;</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span>

<span class="ruby-comment">##</span>
</pre>

<p>#</p>

<pre class="ruby"><span class="ruby-comment">#</span>
<span class="ruby-comment"># Is the extension `name` enabled?</span>

<span class="ruby-keyword">def</span> <span class="ruby-identifier">extension?</span> <span class="ruby-identifier">name</span>
  <span class="ruby-ivar">@extensions</span>.<span class="ruby-identifier">include?</span> <span class="ruby-identifier">name</span>
<span class="ruby-keyword">end</span>

<span class="ruby-comment">##</span>
</pre>

<p>#</p>

<pre class="ruby"><span class="ruby-comment">#</span>
<span class="ruby-comment"># Enables or disables the extension with `name`</span>

<span class="ruby-keyword">def</span> <span class="ruby-identifier">extension</span> <span class="ruby-identifier">name</span>, <span class="ruby-identifier">enable</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">enable</span> <span class="ruby-keyword">then</span>
    <span class="ruby-ivar">@extensions</span> <span class="ruby-operator">|=</span> [<span class="ruby-identifier">name</span>]
  <span class="ruby-keyword">else</span>
    <span class="ruby-ivar">@extensions</span> <span class="ruby-operator">-=</span> [<span class="ruby-identifier">name</span>]
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span>

<span class="ruby-comment">##</span>
<span class="ruby-comment"># Parses `text` in a clone of this parser.  This is used for handling nested</span>
<span class="ruby-comment"># lists the same way as markdown_parser.</span>

<span class="ruby-keyword">def</span> <span class="ruby-identifier">inner_parse</span> <span class="ruby-identifier">text</span> <span class="ruby-comment"># :nodoc:</span>
  <span class="ruby-identifier">parser</span> = <span class="ruby-identifier">clone</span>

  <span class="ruby-identifier">parser</span>.<span class="ruby-identifier">setup_parser</span> <span class="ruby-identifier">text</span>, <span class="ruby-ivar">@debug</span>

  <span class="ruby-identifier">parser</span>.<span class="ruby-identifier">peg_parse</span>

  <span class="ruby-identifier">doc</span> = <span class="ruby-identifier">parser</span>.<span class="ruby-identifier">result</span>

  <span class="ruby-identifier">doc</span>.<span class="ruby-identifier">accept</span> <span class="ruby-ivar">@formatter</span>

  <span class="ruby-identifier">doc</span>.<span class="ruby-identifier">parts</span>
<span class="ruby-keyword">end</span>

<span class="ruby-comment">##</span>
<span class="ruby-comment"># Finds a link reference for `label` and creates a new link to it with</span>
<span class="ruby-comment"># `content` as the link text.  If `label` was not encountered in the</span>
<span class="ruby-comment"># reference-gathering parser pass the label and content are reconstructed</span>
<span class="ruby-comment"># with the linking `text` (usually whitespace).</span>

<span class="ruby-keyword">def</span> <span class="ruby-identifier">link_to</span> <span class="ruby-identifier">content</span>, <span class="ruby-identifier">label</span> = <span class="ruby-identifier">content</span>, <span class="ruby-identifier">text</span> = <span class="ruby-keyword">nil</span>
  <span class="ruby-identifier">raise</span> <span class="ruby-string">&#39;enable notes extension&#39;</span> <span class="ruby-keyword">if</span>
    <span class="ruby-identifier">content</span>.<span class="ruby-identifier">start_with?</span> <span class="ruby-string">&#39;^&#39;</span> <span class="ruby-keyword">and</span> <span class="ruby-identifier">label</span>.<span class="ruby-identifier">equal?</span> <span class="ruby-identifier">content</span>

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">ref</span> = <span class="ruby-ivar">@references</span>[<span class="ruby-identifier">label</span>] <span class="ruby-keyword">then</span>
    <span class="ruby-node">&quot;{#{content}}[#{ref}]&quot;</span>
  <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">label</span>.<span class="ruby-identifier">equal?</span> <span class="ruby-identifier">content</span> <span class="ruby-keyword">then</span>
    <span class="ruby-node">&quot;[#{content}]#{text}&quot;</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-node">&quot;[#{content}]#{text}[#{label}]&quot;</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span>

<span class="ruby-comment">##</span>
<span class="ruby-comment"># Creates an RDoc::Markup::ListItem by parsing the `unparsed` content from</span>
<span class="ruby-comment"># the first parsing pass.</span>

<span class="ruby-keyword">def</span> <span class="ruby-identifier">list_item_from</span> <span class="ruby-identifier">unparsed</span>
  <span class="ruby-identifier">parsed</span> = <span class="ruby-identifier">inner_parse</span> <span class="ruby-identifier">unparsed</span>.<span class="ruby-identifier">join</span>
  <span class="ruby-constant">RDoc</span><span class="ruby-operator">::</span><span class="ruby-constant">Markup</span><span class="ruby-operator">::</span><span class="ruby-constant">ListItem</span>.<span class="ruby-identifier">new</span> <span class="ruby-keyword">nil</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">parsed</span>
<span class="ruby-keyword">end</span>

<span class="ruby-comment">##</span>
<span class="ruby-comment"># Stores `label` as a note and fills in previously unknown note references.</span>

<span class="ruby-keyword">def</span> <span class="ruby-identifier">note</span> <span class="ruby-identifier">label</span>
  <span class="ruby-comment">#foottext = &quot;rdoc-label:foottext-#{label}:footmark-#{label}&quot;</span>

  <span class="ruby-comment">#ref.replace foottext if ref = @unlinked_notes.delete(label)</span>

  <span class="ruby-ivar">@notes</span>[<span class="ruby-identifier">label</span>] = <span class="ruby-identifier">foottext</span>

  <span class="ruby-comment">#&quot;{^1}[rdoc-label:footmark-#{label}:foottext-#{label}] &quot;</span>
<span class="ruby-keyword">end</span>

<span class="ruby-comment">##</span>
<span class="ruby-comment"># Creates a new link for the footnote `reference` and adds the reference to</span>
<span class="ruby-comment"># the note order list for proper display at the end of the document.</span>

<span class="ruby-keyword">def</span> <span class="ruby-identifier">note_for</span> <span class="ruby-identifier">ref</span>
  <span class="ruby-ivar">@note_order</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">ref</span>

  <span class="ruby-identifier">label</span> = <span class="ruby-ivar">@note_order</span>.<span class="ruby-identifier">length</span>

  <span class="ruby-node">&quot;{*#{label}}[rdoc-label:foottext-#{label}:footmark-#{label}]&quot;</span>
<span class="ruby-keyword">end</span>

<span class="ruby-comment">##</span>
<span class="ruby-comment"># The internal kpeg parse method</span>

<span class="ruby-keyword">alias</span> <span class="ruby-identifier">peg_parse</span> <span class="ruby-identifier">parse</span> <span class="ruby-comment"># :nodoc:</span>

<span class="ruby-comment">##</span>
<span class="ruby-comment"># Creates an RDoc::Markup::Paragraph from `parts` and including</span>
<span class="ruby-comment"># extension-specific behavior</span>

<span class="ruby-keyword">def</span> <span class="ruby-identifier">paragraph</span> <span class="ruby-identifier">parts</span>
  <span class="ruby-identifier">parts</span> = <span class="ruby-identifier">parts</span>.<span class="ruby-identifier">map</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">part</span><span class="ruby-operator">|</span>
    <span class="ruby-keyword">if</span> <span class="ruby-string">&quot;\n&quot;</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">part</span> <span class="ruby-keyword">then</span>
      <span class="ruby-constant">RDoc</span><span class="ruby-operator">::</span><span class="ruby-constant">Markup</span><span class="ruby-operator">::</span><span class="ruby-constant">HardBreak</span>.<span class="ruby-identifier">new</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-identifier">part</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">break_on_newline?</span>

  <span class="ruby-constant">RDoc</span><span class="ruby-operator">::</span><span class="ruby-constant">Markup</span><span class="ruby-operator">::</span><span class="ruby-constant">Paragraph</span>.<span class="ruby-identifier">new</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">parts</span>)
<span class="ruby-keyword">end</span>

<span class="ruby-comment">##</span>
<span class="ruby-comment"># Parses `markdown` into an RDoc::Document</span>

<span class="ruby-keyword">def</span> <span class="ruby-identifier">parse</span> <span class="ruby-identifier">markdown</span>
  <span class="ruby-ivar">@references</span>          = {}
  <span class="ruby-ivar">@unlinked_references</span> = {}

  <span class="ruby-identifier">markdown</span> <span class="ruby-operator">+=</span> <span class="ruby-string">&quot;\n\n&quot;</span>

  <span class="ruby-identifier">setup_parser</span> <span class="ruby-identifier">markdown</span>, <span class="ruby-ivar">@debug</span>
  <span class="ruby-identifier">peg_parse</span> <span class="ruby-string">&#39;References&#39;</span>

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">notes?</span> <span class="ruby-keyword">then</span>
    <span class="ruby-ivar">@footnotes</span>       = {}

    <span class="ruby-identifier">setup_parser</span> <span class="ruby-identifier">markdown</span>, <span class="ruby-ivar">@debug</span>
    <span class="ruby-identifier">peg_parse</span> <span class="ruby-string">&#39;Notes&#39;</span>

    <span class="ruby-comment"># using note_order on the first pass would be a bug</span>
    <span class="ruby-ivar">@note_order</span>      = []
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">setup_parser</span> <span class="ruby-identifier">markdown</span>, <span class="ruby-ivar">@debug</span>
  <span class="ruby-identifier">peg_parse</span>

  <span class="ruby-identifier">doc</span> = <span class="ruby-identifier">result</span>

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">notes?</span> <span class="ruby-keyword">and</span> <span class="ruby-keyword">not</span> <span class="ruby-ivar">@footnotes</span>.<span class="ruby-identifier">empty?</span> <span class="ruby-keyword">then</span>
    <span class="ruby-identifier">doc</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-constant">RDoc</span><span class="ruby-operator">::</span><span class="ruby-constant">Markup</span><span class="ruby-operator">::</span><span class="ruby-constant">Rule</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value">1</span>)

    <span class="ruby-ivar">@note_order</span>.<span class="ruby-identifier">each_with_index</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">ref</span>, <span class="ruby-identifier">index</span><span class="ruby-operator">|</span>
      <span class="ruby-identifier">label</span> = <span class="ruby-identifier">index</span> <span class="ruby-operator">+</span> <span class="ruby-value">1</span>
      <span class="ruby-identifier">note</span> = <span class="ruby-ivar">@footnotes</span>[<span class="ruby-identifier">ref</span>]

      <span class="ruby-identifier">link</span> = <span class="ruby-node">&quot;{^#{label}}[rdoc-label:footmark-#{label}:foottext-#{label}] &quot;</span>
      <span class="ruby-identifier">note</span>.<span class="ruby-identifier">parts</span>.<span class="ruby-identifier">unshift</span> <span class="ruby-identifier">link</span>

      <span class="ruby-identifier">doc</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">note</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">doc</span>.<span class="ruby-identifier">accept</span> <span class="ruby-ivar">@formatter</span>

  <span class="ruby-identifier">doc</span>
<span class="ruby-keyword">end</span>

<span class="ruby-comment">##</span>
<span class="ruby-comment"># Stores `label` as a reference to `link` and fills in previously unknown</span>
<span class="ruby-comment"># link references.</span>

<span class="ruby-keyword">def</span> <span class="ruby-identifier">reference</span> <span class="ruby-identifier">label</span>, <span class="ruby-identifier">link</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">ref</span> = <span class="ruby-ivar">@unlinked_references</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-identifier">label</span>) <span class="ruby-keyword">then</span>
    <span class="ruby-identifier">ref</span>.<span class="ruby-identifier">replace</span> <span class="ruby-identifier">link</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-ivar">@references</span>[<span class="ruby-identifier">label</span>] = <span class="ruby-identifier">link</span>
<span class="ruby-keyword">end</span>

<span class="ruby-comment">##</span>
<span class="ruby-comment"># Wraps `text` in strong markup for rdoc inline formatting</span>

<span class="ruby-keyword">def</span> <span class="ruby-identifier">strong</span> <span class="ruby-identifier">text</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">text</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp">/\A[a-z\d.\/-]+\z/</span> <span class="ruby-keyword">then</span>
    <span class="ruby-node">&quot;*#{text}*&quot;</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-node">&quot;&lt;b&gt;#{text}&lt;/b&gt;&quot;</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span>
</pre>

<p>}</p>

<p>root = Doc</p>

<p>Doc =       BOM? Block*:a { <a
href="../../RDoc/Markup/Document.html#method-c-new">RDoc::Markup::Document.new</a>
}</p>

<p>Block =     @BlankLine*</p>

<pre>( BlockQuote
| Verbatim
| CodeFence
| Note
| Reference
| HorizontalRule
| Heading
| OrderedList
| BulletList
| DefinitionList
| HtmlBlock
| StyleBlock
| Para
| Plain )</pre>

<p>Para =      @NonindentSpace Inlines:a @BlankLine+</p>

<pre>{ paragraph a }</pre>

<p>Plain =     Inlines:a</p>

<pre>{ paragraph a }</pre>

<p>AtxInline = !@Newline !(@Sp? /#*/ @Sp @Newline) Inline</p>

<p>AtxStart =  &lt; /#{1,6}/ &gt;</p>

<pre>{ text.length }</pre>

<p>AtxHeading = AtxStart:s @Sp? AtxInline+:a (@Sp? /#*/ @Sp)?  @Newline</p>

<pre>{ RDoc::Markup::Heading.new(s, a.join) }</pre>

<p>SetextHeading = SetextHeading1 | SetextHeading2</p>

<p>SetextBottom1 = /={3,}/ @Newline</p>

<p>SetextBottom2 = /-{3,}/ @Newline</p>

<p>SetextHeading1 =  &amp;(@RawLine SetextBottom1)</p>

<pre>@StartList:a ( !@Endline Inline:b { a &lt;&lt; b } )+ @Sp? @Newline
SetextBottom1
{ RDoc::Markup::Heading.new(1, a.join) }</pre>

<p>SetextHeading2 =  &amp;(@RawLine SetextBottom2)</p>

<pre>@StartList:a ( !@Endline Inline:b { a &lt;&lt; b })+ @Sp? @Newline
SetextBottom2
{ RDoc::Markup::Heading.new(2, a.join) }</pre>

<p>Heading = SetextHeading | AtxHeading</p>

<p>BlockQuote = BlockQuoteRaw:a</p>

<pre>{ RDoc::Markup::BlockQuote.new(*a) }</pre>

<p>BlockQuoteRaw =  @StartList:a</p>

<pre>(( &quot;&gt;&quot; &quot; &quot;? Line:l { a &lt;&lt; l } )
 ( !&quot;&gt;&quot; !@BlankLine Line:c { a &lt;&lt; c } )*
 ( @BlankLine:n { a &lt;&lt; n } )*
)+
{ inner_parse a.join }</pre>

<p>NonblankIndentedLine = !@BlankLine IndentedLine</p>

<p>VerbatimChunk = @BlankLine*:a</p>

<pre>NonblankIndentedLine+:b
{ a.concat b }</pre>

<p>Verbatim =     VerbatimChunk+:a</p>

<pre>{ RDoc::Markup::Verbatim.new(*a.flatten) }</pre>

<p>HorizontalRule = @NonindentSpace</p>

<pre>( &quot;*&quot; @Sp &quot;*&quot; @Sp &quot;*&quot; (@Sp &quot;*&quot;)*
| &quot;-&quot; @Sp &quot;-&quot; @Sp &quot;-&quot; (@Sp &quot;-&quot;)*
| &quot;_&quot; @Sp &quot;_&quot; @Sp &quot;_&quot; (@Sp &quot;_&quot;)*)
@Sp @Newline @BlankLine+
{ RDoc::Markup::Rule.new 1 }</pre>

<p>Bullet = !HorizontalRule @NonindentSpace /[+*-]/ @Spacechar+</p>

<p>BulletList = &amp;Bullet (ListTight | ListLoose):a</p>

<pre>{ RDoc::Markup::List.new(:BULLET, *a) }</pre>

<p>ListTight = ListItemTight+:a</p>

<pre>@BlankLine* !(Bullet | Enumerator)
{ a }</pre>

<p>ListLoose = @StartList:a</p>

<pre>( ListItem:b @BlankLine* { a &lt;&lt; b } )+
{ a }</pre>

<p>ListItem =  ( Bullet | Enumerator )</p>

<pre>@StartList:a
ListBlock:b { a &lt;&lt; b }
( ListContinuationBlock:c { a.push(*c) } )*
{ list_item_from a }</pre>

<p>ListItemTight =</p>

<pre>( Bullet | Enumerator )
ListBlock:a
( !@BlankLine
  ListContinuationBlock:b { a.push(*b) } )*
!ListContinuationBlock
{ list_item_from a }</pre>

<p>ListBlock = !@BlankLine Line:a</p>

<pre>ListBlockLine*:c
{ [a, *c] }</pre>

<p>ListContinuationBlock = @StartList:a</p>

<pre>( @BlankLine*
  { a &lt;&lt; &quot;\n&quot; } )
( Indent
  ListBlock:b { a.concat b } )+
{ a }</pre>

<p>Enumerator = @NonindentSpace [0-9]+ “.” @Spacechar+</p>

<p>OrderedList = &amp;Enumerator (ListTight | ListLoose):a</p>

<pre>{ RDoc::Markup::List.new(:NUMBER, *a) }</pre>

<p>ListBlockLine = !@BlankLine</p>

<pre>!( Indent? (Bullet | Enumerator) )
!HorizontalRule
OptionallyIndentedLine</pre>

<p># Parsers for different kinds of block-level HTML content. # This is
repetitive due to constraints of PEG grammar.</p>

<p>HtmlOpenAnchor = “&lt;” Spnl (“a” | “A”) Spnl HtmlAttribute* “&gt;”
HtmlCloseAnchor = “&lt;” Spnl “/” (“a” | “A”) Spnl “&gt;” HtmlAnchor =
HtmlOpenAnchor (HtmlAnchor | !HtmlCloseAnchor .)* HtmlCloseAnchor</p>

<p>HtmlBlockOpenAddress = “&lt;” Spnl (“address” | “ADDRESS”) Spnl
HtmlAttribute* “&gt;” HtmlBlockCloseAddress = “&lt;” Spnl “/” (“address” |
“ADDRESS”) Spnl “&gt;” HtmlBlockAddress = HtmlBlockOpenAddress
(HtmlBlockAddress | !HtmlBlockCloseAddress .)* HtmlBlockCloseAddress</p>

<p>HtmlBlockOpenBlockquote = “&lt;” Spnl (“blockquote” | “BLOCKQUOTE”) Spnl
HtmlAttribute* “&gt;” HtmlBlockCloseBlockquote = “&lt;” Spnl “/”
(“blockquote” | “BLOCKQUOTE”) Spnl “&gt;” HtmlBlockBlockquote =
HtmlBlockOpenBlockquote (HtmlBlockBlockquote | !HtmlBlockCloseBlockquote
.)* HtmlBlockCloseBlockquote</p>

<p>HtmlBlockOpenCenter = “&lt;” Spnl (“center” | “CENTER”) Spnl HtmlAttribute*
“&gt;” HtmlBlockCloseCenter = “&lt;” Spnl “/” (“center” | “CENTER”) Spnl
“&gt;” HtmlBlockCenter = HtmlBlockOpenCenter (HtmlBlockCenter |
!HtmlBlockCloseCenter .)* HtmlBlockCloseCenter</p>

<p>HtmlBlockOpenDir = “&lt;” Spnl (“dir” | “DIR”) Spnl HtmlAttribute* “&gt;”
HtmlBlockCloseDir = “&lt;” Spnl “/” (“dir” | “DIR”) Spnl “&gt;”
HtmlBlockDir = HtmlBlockOpenDir (HtmlBlockDir | !HtmlBlockCloseDir .)*
HtmlBlockCloseDir</p>

<p>HtmlBlockOpenDiv = “&lt;” Spnl (“div” | “DIV”) Spnl HtmlAttribute* “&gt;”
HtmlBlockCloseDiv = “&lt;” Spnl “/” (“div” | “DIV”) Spnl “&gt;”
HtmlBlockDiv = HtmlBlockOpenDiv (HtmlBlockDiv | !HtmlBlockCloseDiv .)*
HtmlBlockCloseDiv</p>

<p>HtmlBlockOpenDl = “&lt;” Spnl (“dl” | “DL”) Spnl HtmlAttribute* “&gt;”
HtmlBlockCloseDl = “&lt;” Spnl “/” (“dl” | “DL”) Spnl “&gt;” HtmlBlockDl =
HtmlBlockOpenDl (HtmlBlockDl | !HtmlBlockCloseDl .)* HtmlBlockCloseDl</p>

<p>HtmlBlockOpenFieldset = “&lt;” Spnl (“fieldset” | “FIELDSET”) Spnl
HtmlAttribute* “&gt;” HtmlBlockCloseFieldset = “&lt;” Spnl “/” (“fieldset”
| “FIELDSET”) Spnl “&gt;” HtmlBlockFieldset = HtmlBlockOpenFieldset
(HtmlBlockFieldset | !HtmlBlockCloseFieldset .)* HtmlBlockCloseFieldset</p>

<p>HtmlBlockOpenForm = “&lt;” Spnl (“form” | “FORM”) Spnl HtmlAttribute*
“&gt;” HtmlBlockCloseForm = “&lt;” Spnl “/” (“form” | “FORM”) Spnl “&gt;”
HtmlBlockForm = HtmlBlockOpenForm (HtmlBlockForm | !HtmlBlockCloseForm .)*
HtmlBlockCloseForm</p>

<p>HtmlBlockOpenH1 = “&lt;” Spnl (“h1” | “H1”) Spnl HtmlAttribute* “&gt;”
HtmlBlockCloseH1 = “&lt;” Spnl “/” (“h1” | “H1”) Spnl “&gt;” HtmlBlockH1 =
HtmlBlockOpenH1 (HtmlBlockH1 | !HtmlBlockCloseH1 .)* HtmlBlockCloseH1</p>

<p>HtmlBlockOpenH2 = “&lt;” Spnl (“h2” | “H2”) Spnl HtmlAttribute* “&gt;”
HtmlBlockCloseH2 = “&lt;” Spnl “/” (“h2” | “H2”) Spnl “&gt;” HtmlBlockH2 =
HtmlBlockOpenH2 (HtmlBlockH2 | !HtmlBlockCloseH2 .)* HtmlBlockCloseH2</p>

<p>HtmlBlockOpenH3 = “&lt;” Spnl (“h3” | “H3”) Spnl HtmlAttribute* “&gt;”
HtmlBlockCloseH3 = “&lt;” Spnl “/” (“h3” | “H3”) Spnl “&gt;” HtmlBlockH3 =
HtmlBlockOpenH3 (HtmlBlockH3 | !HtmlBlockCloseH3 .)* HtmlBlockCloseH3</p>

<p>HtmlBlockOpenH4 = “&lt;” Spnl (“h4” | “H4”) Spnl HtmlAttribute* “&gt;”
HtmlBlockCloseH4 = “&lt;” Spnl “/” (“h4” | “H4”) Spnl “&gt;” HtmlBlockH4 =
HtmlBlockOpenH4 (HtmlBlockH4 | !HtmlBlockCloseH4 .)* HtmlBlockCloseH4</p>

<p>HtmlBlockOpenH5 = “&lt;” Spnl (“h5” | “H5”) Spnl HtmlAttribute* “&gt;”
HtmlBlockCloseH5 = “&lt;” Spnl “/” (“h5” | “H5”) Spnl “&gt;” HtmlBlockH5 =
HtmlBlockOpenH5 (HtmlBlockH5 | !HtmlBlockCloseH5 .)* HtmlBlockCloseH5</p>

<p>HtmlBlockOpenH6 = “&lt;” Spnl (“h6” | “H6”) Spnl HtmlAttribute* “&gt;”
HtmlBlockCloseH6 = “&lt;” Spnl “/” (“h6” | “H6”) Spnl “&gt;” HtmlBlockH6 =
HtmlBlockOpenH6 (HtmlBlockH6 | !HtmlBlockCloseH6 .)* HtmlBlockCloseH6</p>

<p>HtmlBlockOpenMenu = “&lt;” Spnl (“menu” | “MENU”) Spnl HtmlAttribute*
“&gt;” HtmlBlockCloseMenu = “&lt;” Spnl “/” (“menu” | “MENU”) Spnl “&gt;”
HtmlBlockMenu = HtmlBlockOpenMenu (HtmlBlockMenu | !HtmlBlockCloseMenu .)*
HtmlBlockCloseMenu</p>

<p>HtmlBlockOpenNoframes = “&lt;” Spnl (“noframes” | “NOFRAMES”) Spnl
HtmlAttribute* “&gt;” HtmlBlockCloseNoframes = “&lt;” Spnl “/” (“noframes”
| “NOFRAMES”) Spnl “&gt;” HtmlBlockNoframes = HtmlBlockOpenNoframes
(HtmlBlockNoframes | !HtmlBlockCloseNoframes .)* HtmlBlockCloseNoframes</p>

<p>HtmlBlockOpenNoscript = “&lt;” Spnl (“noscript” | “NOSCRIPT”) Spnl
HtmlAttribute* “&gt;” HtmlBlockCloseNoscript = “&lt;” Spnl “/” (“noscript”
| “NOSCRIPT”) Spnl “&gt;” HtmlBlockNoscript = HtmlBlockOpenNoscript
(HtmlBlockNoscript | !HtmlBlockCloseNoscript .)* HtmlBlockCloseNoscript</p>

<p>HtmlBlockOpenOl = “&lt;” Spnl (“ol” | “OL”) Spnl HtmlAttribute* “&gt;”
HtmlBlockCloseOl = “&lt;” Spnl “/” (“ol” | “OL”) Spnl “&gt;” HtmlBlockOl =
HtmlBlockOpenOl (HtmlBlockOl | !HtmlBlockCloseOl .)* HtmlBlockCloseOl</p>

<p>HtmlBlockOpenP = “&lt;” Spnl (“p” | “P”) Spnl HtmlAttribute* “&gt;”
HtmlBlockCloseP = “&lt;” Spnl “/” (“p” | “P”) Spnl “&gt;” HtmlBlockP =
HtmlBlockOpenP (HtmlBlockP | !HtmlBlockCloseP .)* HtmlBlockCloseP</p>

<p>HtmlBlockOpenPre = “&lt;” Spnl (“pre” | “PRE”) Spnl HtmlAttribute* “&gt;”
HtmlBlockClosePre = “&lt;” Spnl “/” (“pre” | “PRE”) Spnl “&gt;”
HtmlBlockPre = HtmlBlockOpenPre (HtmlBlockPre | !HtmlBlockClosePre .)*
HtmlBlockClosePre</p>

<p>HtmlBlockOpenTable = “&lt;” Spnl (“table” | “TABLE”) Spnl HtmlAttribute*
“&gt;” HtmlBlockCloseTable = “&lt;” Spnl “/” (“table” | “TABLE”) Spnl
“&gt;” HtmlBlockTable = HtmlBlockOpenTable (HtmlBlockTable |
!HtmlBlockCloseTable .)* HtmlBlockCloseTable</p>

<p>HtmlBlockOpenUl = “&lt;” Spnl (“ul” | “UL”) Spnl HtmlAttribute* “&gt;”
HtmlBlockCloseUl = “&lt;” Spnl “/” (“ul” | “UL”) Spnl “&gt;” HtmlBlockUl =
HtmlBlockOpenUl (HtmlBlockUl | !HtmlBlockCloseUl .)* HtmlBlockCloseUl</p>

<p>HtmlBlockOpenDd = “&lt;” Spnl (“dd” | “DD”) Spnl HtmlAttribute* “&gt;”
HtmlBlockCloseDd = “&lt;” Spnl “/” (“dd” | “DD”) Spnl “&gt;” HtmlBlockDd =
HtmlBlockOpenDd (HtmlBlockDd | !HtmlBlockCloseDd .)* HtmlBlockCloseDd</p>

<p>HtmlBlockOpenDt = “&lt;” Spnl (“dt” | “DT”) Spnl HtmlAttribute* “&gt;”
HtmlBlockCloseDt = “&lt;” Spnl “/” (“dt” | “DT”) Spnl “&gt;” HtmlBlockDt =
HtmlBlockOpenDt (HtmlBlockDt | !HtmlBlockCloseDt .)* HtmlBlockCloseDt</p>

<p>HtmlBlockOpenFrameset = “&lt;” Spnl (“frameset” | “FRAMESET”) Spnl
HtmlAttribute* “&gt;” HtmlBlockCloseFrameset = “&lt;” Spnl “/” (“frameset”
| “FRAMESET”) Spnl “&gt;” HtmlBlockFrameset = HtmlBlockOpenFrameset
(HtmlBlockFrameset | !HtmlBlockCloseFrameset .)* HtmlBlockCloseFrameset</p>

<p>HtmlBlockOpenLi = “&lt;” Spnl (“li” | “LI”) Spnl HtmlAttribute* “&gt;”
HtmlBlockCloseLi = “&lt;” Spnl “/” (“li” | “LI”) Spnl “&gt;” HtmlBlockLi =
HtmlBlockOpenLi (HtmlBlockLi | !HtmlBlockCloseLi .)* HtmlBlockCloseLi</p>

<p>HtmlBlockOpenTbody = “&lt;” Spnl (“tbody” | “TBODY”) Spnl HtmlAttribute*
“&gt;” HtmlBlockCloseTbody = “&lt;” Spnl “/” (“tbody” | “TBODY”) Spnl
“&gt;” HtmlBlockTbody = HtmlBlockOpenTbody (HtmlBlockTbody |
!HtmlBlockCloseTbody .)* HtmlBlockCloseTbody</p>

<p>HtmlBlockOpenTd = “&lt;” Spnl (“td” | “TD”) Spnl HtmlAttribute* “&gt;”
HtmlBlockCloseTd = “&lt;” Spnl “/” (“td” | “TD”) Spnl “&gt;” HtmlBlockTd =
HtmlBlockOpenTd (HtmlBlockTd | !HtmlBlockCloseTd .)* HtmlBlockCloseTd</p>

<p>HtmlBlockOpenTfoot = “&lt;” Spnl (“tfoot” | “TFOOT”) Spnl HtmlAttribute*
“&gt;” HtmlBlockCloseTfoot = “&lt;” Spnl “/” (“tfoot” | “TFOOT”) Spnl
“&gt;” HtmlBlockTfoot = HtmlBlockOpenTfoot (HtmlBlockTfoot |
!HtmlBlockCloseTfoot .)* HtmlBlockCloseTfoot</p>

<p>HtmlBlockOpenTh = “&lt;” Spnl (“th” | “TH”) Spnl HtmlAttribute* “&gt;”
HtmlBlockCloseTh = “&lt;” Spnl “/” (“th” | “TH”) Spnl “&gt;” HtmlBlockTh =
HtmlBlockOpenTh (HtmlBlockTh | !HtmlBlockCloseTh .)* HtmlBlockCloseTh</p>

<p>HtmlBlockOpenThead = “&lt;” Spnl (“thead” | “THEAD”) Spnl HtmlAttribute*
“&gt;” HtmlBlockCloseThead = “&lt;” Spnl “/” (“thead” | “THEAD”) Spnl
“&gt;” HtmlBlockThead = HtmlBlockOpenThead (HtmlBlockThead |
!HtmlBlockCloseThead .)* HtmlBlockCloseThead</p>

<p>HtmlBlockOpenTr = “&lt;” Spnl (“tr” | “TR”) Spnl HtmlAttribute* “&gt;”
HtmlBlockCloseTr = “&lt;” Spnl “/” (“tr” | “TR”) Spnl “&gt;” HtmlBlockTr =
HtmlBlockOpenTr (HtmlBlockTr | !HtmlBlockCloseTr .)* HtmlBlockCloseTr</p>

<p>HtmlBlockOpenScript = “&lt;” Spnl (“script” | “SCRIPT”) Spnl HtmlAttribute*
“&gt;” HtmlBlockCloseScript = “&lt;” Spnl “/” (“script” | “SCRIPT”) Spnl
“&gt;” HtmlBlockScript = HtmlBlockOpenScript (!HtmlBlockCloseScript .)*
HtmlBlockCloseScript</p>

<p>HtmlBlockInTags = HtmlAnchor</p>

<pre>| HtmlBlockAddress
| HtmlBlockBlockquote
| HtmlBlockCenter
| HtmlBlockDir
| HtmlBlockDiv
| HtmlBlockDl
| HtmlBlockFieldset
| HtmlBlockForm
| HtmlBlockH1
| HtmlBlockH2
| HtmlBlockH3
| HtmlBlockH4
| HtmlBlockH5
| HtmlBlockH6
| HtmlBlockMenu
| HtmlBlockNoframes
| HtmlBlockNoscript
| HtmlBlockOl
| HtmlBlockP
| HtmlBlockPre
| HtmlBlockTable
| HtmlBlockUl
| HtmlBlockDd
| HtmlBlockDt
| HtmlBlockFrameset
| HtmlBlockLi
| HtmlBlockTbody
| HtmlBlockTd
| HtmlBlockTfoot
| HtmlBlockTh
| HtmlBlockThead
| HtmlBlockTr
| HtmlBlockScript</pre>

<p>HtmlBlock = &lt; ( HtmlBlockInTags | HtmlComment | HtmlBlockSelfClosing |
HtmlUnclosed) &gt;</p>

<pre>@BlankLine+
{ if html? then
    RDoc::Markup::Raw.new text
  end }</pre>

<p>HtmlUnclosed = “&lt;” Spnl HtmlUnclosedType Spnl HtmlAttribute* Spnl “&gt;”</p>

<p>HtmlUnclosedType = “HR” | “hr”</p>

<p>HtmlBlockSelfClosing = “&lt;” Spnl HtmlBlockType Spnl HtmlAttribute* “/”
Spnl “&gt;”</p>

<p>HtmlBlockType = “ADDRESS” |</p>

<pre>&quot;BLOCKQUOTE&quot; |
&quot;CENTER&quot; |
&quot;DD&quot; |
&quot;DIR&quot; |
&quot;DIV&quot; |
&quot;DL&quot; |
&quot;DT&quot; |
&quot;FIELDSET&quot; |
&quot;FORM&quot; |
&quot;FRAMESET&quot; |
&quot;H1&quot; |
&quot;H2&quot; |
&quot;H3&quot; |
&quot;H4&quot; |
&quot;H5&quot; |
&quot;H6&quot; |
&quot;HR&quot; |
&quot;ISINDEX&quot; |
&quot;LI&quot; |
&quot;MENU&quot; |
&quot;NOFRAMES&quot; |
&quot;NOSCRIPT&quot; |
&quot;OL&quot; |
&quot;P&quot; |
&quot;PRE&quot; |
&quot;SCRIPT&quot; |
&quot;TABLE&quot; |
&quot;TBODY&quot; |
&quot;TD&quot; |
&quot;TFOOT&quot; |
&quot;TH&quot; |
&quot;THEAD&quot; |
&quot;TR&quot; |
&quot;UL&quot; |
&quot;address&quot; |
&quot;blockquote&quot; |
&quot;center&quot; |
&quot;dd&quot; |
&quot;dir&quot; |
&quot;div&quot; |
&quot;dl&quot; |
&quot;dt&quot; |
&quot;fieldset&quot; |
&quot;form&quot; |
&quot;frameset&quot; |
&quot;h1&quot; |
&quot;h2&quot; |
&quot;h3&quot; |
&quot;h4&quot; |
&quot;h5&quot; |
&quot;h6&quot; |
&quot;hr&quot; |
&quot;isindex&quot; |
&quot;li&quot; |
&quot;menu&quot; |
&quot;noframes&quot; |
&quot;noscript&quot; |
&quot;ol&quot; |
&quot;p&quot; |
&quot;pre&quot; |
&quot;script&quot; |
&quot;table&quot; |
&quot;tbody&quot; |
&quot;td&quot; |
&quot;tfoot&quot; |
&quot;th&quot; |
&quot;thead&quot; |
&quot;tr&quot; |
&quot;ul&quot;</pre>

<p>StyleOpen =     “&lt;” Spnl (“style” | “STYLE”) Spnl HtmlAttribute* “&gt;”
StyleClose =    “&lt;” Spnl “/” (“style” | “STYLE”) Spnl “&gt;” InStyleTags
=   StyleOpen (!StyleClose .)* StyleClose StyleBlock =    &lt; InStyleTags
&gt;</p>

<pre>@BlankLine*
{ if css? then
    RDoc::Markup::Raw.new text
  end }</pre>

<p>Inlines  =  ( !@Endline Inline:i { i }</p>

<pre>| @Endline:c &amp;Inline { c } )+:chunks @Endline?
{ chunks }</pre>

<p>Inline  = Str</p>

<pre>| @Endline
| UlOrStarLine
| @Space
| Strong
| Emph
| Image
| Link
| NoteReference
| InlineNote
| Code
| RawHtml
| Entity
| EscapedChar
| Symbol</pre>

<p>Space = @Spacechar+ { “ ” }</p>

<p>Str = @StartList:a</p>

<pre>&lt; @NormalChar+ &gt; { a = text }
( StrChunk:c { a &lt;&lt; c } )* { a }</pre>

<p>StrChunk = &lt; (@NormalChar | /_+/ &amp;Alphanumeric)+ &gt; { text }</p>

<p>EscapedChar =   “\” !@Newline &lt; /[:\`|*_{}[]()#+.!&gt;&lt;-]/ &gt; {
text }</p>

<p>Entity =    ( HexEntity | DecEntity | CharEntity ):a { a }</p>

<p>Endline =   @LineBreak | @TerminalEndline | @NormalEndline</p>

<p>NormalEndline =   @Sp @Newline !@BlankLine !“&gt;” !AtxStart</p>

<pre>!(Line /={3,}|-{3,}=/ @Newline)
{ &quot;\n&quot; }</pre>

<p>TerminalEndline = @Sp @Newline @Eof</p>

<p>LineBreak = “  ” @NormalEndline { <a
href="../../RDoc/Markup/HardBreak.html#method-c-new">RDoc::Markup::HardBreak.new</a>
}</p>

<p>Symbol = &lt; @SpecialChar &gt;</p>

<pre>{ text }</pre>

<p># This keeps the parser from getting bogged down on long strings of
&#39;*&#39; or &#39;_&#39;, # or strings of &#39;*&#39; or &#39;_&#39; with
space on each side: UlOrStarLine =  (UlLine | StarLine):a { a } StarLine =
&lt; /*{4,}/ &gt; { text } |</p>

<pre>&lt; @Spacechar /\*+/ &amp;@Spacechar &gt; { text }</pre>

<p>UlLine   = &lt; /_{4,}/ &gt; { text } |</p>

<pre>&lt; @Spacechar /_+/ &amp;@Spacechar &gt; { text }</pre>

<p>Emph =      EmphStar | EmphUl</p>

<p>OneStarOpen  =  !StarLine “*” !@Spacechar !@Newline OneStarClose = 
!@Spacechar !@Newline Inline:a “*”</p>

<pre>{ a }</pre>

<p>EmphStar =  OneStarOpen</p>

<pre>@StartList:a
( !OneStarClose Inline:l { a &lt;&lt; l } )*
OneStarClose:l { a &lt;&lt; l }
{ emphasis a.join }</pre>

<p>OneUlOpen  =  !UlLine “_” !@Spacechar !@Newline OneUlClose =  !@Spacechar
!@Newline Inline:a “_” # !Alphanumeric # <a
href="../../TODO_rdoc.html">TODO</a> check</p>

<pre>{ a }</pre>

<p>EmphUl =    OneUlOpen</p>

<pre>@StartList:a
( !OneUlClose Inline:l { a &lt;&lt; l } )*
OneUlClose:l { a &lt;&lt; l }
{ emphasis a.join }</pre>

<p>Strong = StrongStar | StrongUl</p>

<p>TwoStarOpen =   !StarLine “**” !@Spacechar !@Newline TwoStarClose = 
!@Spacechar !@Newline Inline:a “**” { a }</p>

<p>StrongStar =    TwoStarOpen</p>

<pre>@StartList:a
( !TwoStarClose Inline:l { a &lt;&lt; l } )*
TwoStarClose:l { a &lt;&lt; l }
{ strong a.join }</pre>

<p>TwoUlOpen =     !UlLine “__” !@Spacechar !@Newline TwoUlClose =   
!@Spacechar !@Newline Inline:a “__” # !Alphanumeric # <a
href="../../TODO_rdoc.html">TODO</a> check</p>

<pre>{ a }</pre>

<p>StrongUl =  TwoUlOpen</p>

<pre>@StartList:a
( !TwoUlClose Inline:i { a &lt;&lt; i } )*
TwoUlClose:l { a &lt;&lt; l }
{ strong a.join }</pre>

<p># <a href="../../TODO_rdoc.html">TODO</a> alt text support Image = “!” (
ExplicitLink | ReferenceLink ):a</p>

<pre>{ &quot;rdoc-image:#{a[/\[(.*)\]/, 1]}&quot; }</pre>

<p>Link =  ExplicitLink | ReferenceLink | AutoLink</p>

<p>ReferenceLink = ReferenceLinkDouble | ReferenceLinkSingle</p>

<p>ReferenceLinkDouble = Label:content &lt; Spnl &gt; !“[]” Label:label</p>

<pre>{ link_to content, label, text }</pre>

<p>ReferenceLinkSingle = Label:content &lt; (Spnl “[]”)? &gt;</p>

<pre>{ link_to content, content, text }</pre>

<p>ExplicitLink =  Label:l Spnl “(” @Sp Source:s Spnl Title @Sp “)”</p>

<pre>{ &quot;{#{l}}[#{s}]&quot; }</pre>

<p>Source  = ( “&lt;” &lt; SourceContents &gt; “&gt;” | &lt; SourceContents
&gt; )</p>

<pre>{ text }</pre>

<p>SourceContents = ( ( !“(” !“)” !“&gt;” Nonspacechar )+ | “(” SourceContents
“)”)*</p>

<pre>| &quot;&quot;</pre>

<p>Title = ( TitleSingle | TitleDouble | “” ):a</p>

<pre>{ a }</pre>

<p>TitleSingle = “&#39;” ( !( “&#39;” @Sp ( “)” | @Newline ) ) . )* “&#39;”</p>

<p>TitleDouble = “&quot;” ( !( “&quot;” @Sp ( “)” | @Newline ) ) . )* “&quot;”</p>

<p>AutoLink = AutoLinkUrl | AutoLinkEmail</p>

<p>AutoLinkUrl =   “&lt;” &lt; /[A-Za-z]+/ “://” ( !@Newline !“&gt;” . )+ &gt;
“&gt;”</p>

<pre>{ text }</pre>

<p>AutoLinkEmail = “&lt;” (“mailto:”)? &lt; /[w+./!%~$-]+/i “@” ( !@Newline
!“&gt;” . )+ &gt; “&gt;”</p>

<pre>{ &quot;mailto:#{text}&quot; }</pre>

<p>Reference = @NonindentSpace !“[]”</p>

<pre>  Label:label &quot;:&quot; Spnl RefSrc:link RefTitle @BlankLine+
{ # TODO use title
  reference label, link
  nil
}</pre>

<p>Label = “[” ( !“^” &amp;{ notes? } | &amp;. &amp;{ !notes? } )</p>

<pre>@StartList:a
( !&quot;]&quot; Inline:l { a &lt;&lt; l } )*
&quot;]&quot;
{ a.join.gsub(/\s+/, &#39; &#39;) }</pre>

<p>RefSrc = &lt; Nonspacechar+ &gt; { text }</p>

<p>RefTitle = ( RefTitleSingle | RefTitleDouble | RefTitleParens | EmptyTitle
)</p>

<p>EmptyTitle = “”</p>

<p>RefTitleSingle = Spnl “&#39;” &lt; ( !( “&#39;” @Sp @Newline | @Newline ) .
)* &gt; “&#39;” { text }</p>

<p>RefTitleDouble = Spnl “&quot;” &lt; ( !(“&quot;” @Sp @Newline | @Newline) .
)* &gt; “&quot;” { text }</p>

<p>RefTitleParens = Spnl “(” &lt; ( !(“)” @Sp @Newline | @Newline) . )* &gt;
“)” { text }</p>

<p>References = ( Reference | SkipBlock )*</p>

<p>Ticks1 = “`” !“`” Ticks2 = ““” !“`” Ticks3 = ““`” !“`” Ticks4 = “““” !“`”
Ticks5 = “““`” !“`”</p>

<p>Code = ( Ticks1 @Sp &lt; (</p>

<pre>    ( !&quot;`&quot; Nonspacechar )+ | !Ticks1 /`+/ |
    !( @Sp Ticks1 ) ( @Spacechar | @Newline !@BlankLine )
  )+ &gt; @Sp Ticks1 |
  Ticks2 @Sp &lt; (
    ( !&quot;`&quot; Nonspacechar )+ |
    !Ticks2 /`+/ |
    !( @Sp Ticks2 ) ( @Spacechar | @Newline !@BlankLine )
  )+ &gt; @Sp Ticks2 |
  Ticks3 @Sp &lt; (
    ( !&quot;`&quot; Nonspacechar )+ |
    !Ticks3 /`+/ |
    !( @Sp Ticks3 ) ( @Spacechar | @Newline !@BlankLine )
  )+ &gt; @Sp Ticks3 |
  Ticks4 @Sp &lt; (
    ( !&quot;`&quot; Nonspacechar )+ |
    !Ticks4 /`+/ |
    !( @Sp Ticks4 ) ( @Spacechar | @Newline !@BlankLine )
  )+ &gt; @Sp Ticks4 |
  Ticks5 @Sp &lt; (
    ( !&quot;`&quot; Nonspacechar )+ |
    !Ticks5 /`+/ |
    !( @Sp Ticks5 ) ( @Spacechar | @Newline !@BlankLine )
  )+ &gt; @Sp Ticks5
)
{ &quot;&lt;code&gt;#{text}&lt;/code&gt;&quot; }</pre>

<p>RawHtml = &lt; (HtmlComment | HtmlBlockScript | HtmlTag) &gt;</p>

<pre>{ if html? then text else &#39;&#39; end }</pre>

<p>BlankLine =     @Sp @Newline { “n” }</p>

<p>Quoted =        “&quot;” (!“&quot;” .)* “&quot;” | “&#39;” (!“&#39;” .)*
“&#39;” HtmlAttribute = (AlphanumericAscii | “-”)+ Spnl (“=” Spnl (Quoted |
(!“&gt;” Nonspacechar)+))? Spnl HtmlComment =   “&lt;!–” (!“–&gt;” .)*
“–&gt;” HtmlTag =       “&lt;” Spnl “/”? AlphanumericAscii+ Spnl
HtmlAttribute* “/”? Spnl “&gt;” Eof =           !. Nonspacechar = 
!@Spacechar !@Newline . Sp =            @Spacechar* Spnl =          @Sp
(@Newline @Sp)? SpecialChar =   /[*<a
href="http://\">_`&</a>()&lt;!#\&#39;“]/ | @ExtendedSpecialChar NormalChar
=    !( @SpecialChar | @Spacechar | @Newline ) . Digit = [0-9]</p>

<p>%literals         = <a
href="../../RDoc/Markdown/Literals.html">RDoc::Markdown::Literals</a>
Alphanumeric      = %literals.Alphanumeric AlphanumericAscii =
%literals.AlphanumericAscii BOM               = %literals.BOM Newline      
= %literals.Newline NonAlphanumeric   = %literals.NonAlphanumeric Spacechar
= %literals.Spacechar</p>

<p>HexEntity  = /&amp;#x/i &lt; /[0-9a-fA-F]+/ &gt; “;”</p>

<pre>{ [text.to_i(16)].pack &#39;U&#39; }</pre>

<p>DecEntity  = “&amp;#”   &lt; /[0-9]+/       &gt; “;”</p>

<pre>{ [text.to_i].pack &#39;U&#39; }</pre>

<p>CharEntity = “&amp;”    &lt;/[A-Za-z0-9]+/  &gt; “;”</p>

<pre>{ if entity = HTML_ENTITIES[text] then
    entity.pack &#39;U*&#39;
  else
    &quot;&amp;#{text};&quot;
  end
}</pre>

<p>NonindentSpace =    / {0,3}/ Indent =            /t|    / IndentedLine =   
Indent Line OptionallyIndentedLine = Indent? Line</p>

<p># StartList starts a list data structure that can be added to with cons:
StartList = &amp;.</p>

<pre>{ [] }</pre>

<p>Line =  @RawLine:a { a } RawLine = ( &lt; (!“r” !“n” .)* @Newline &gt;</p>

<pre>| &lt; .+ &gt; @Eof ) { text }</pre>

<p>SkipBlock = HtmlBlock</p>

<pre>| ( !&quot;#&quot; !SetextBottom1 !SetextBottom2 !@BlankLine @RawLine )+
  @BlankLine*
| @BlankLine+
| @RawLine</pre>

<p># Syntax extensions</p>

<p>ExtendedSpecialChar = &amp;{ notes? } ( “^” )</p>

<p>NoteReference = &amp;{ notes? }</p>

<pre>RawNoteReference:ref
{ note_for ref }</pre>

<p>RawNoteReference = “[^” &lt; ( !@Newline !“]” . )+ &gt; “]” { text }</p>

<p># <a href="../../TODO_rdoc.html">TODO</a> multiple paragraphs for a
footnote Note =          &amp;{ notes? }</p>

<pre>@NonindentSpace RawNoteReference:ref &quot;:&quot; @Sp
@StartList:a
RawNoteBlock:i { a.concat i }
( &amp;Indent RawNoteBlock:i { a.concat i } )*
{ @footnotes[ref] = paragraph a

  nil
}</pre>

<p>InlineNote = &amp;{ notes? }</p>

<pre>&quot;^[&quot;
@StartList:a
( !&quot;]&quot; Inline:l { a &lt;&lt; l } )+
&quot;]&quot;
{
  ref = [:inline, @note_order.length]
  @footnotes[ref] = paragraph a

  note_for ref
}</pre>

<p>Notes = ( Note | SkipBlock )*</p>

<p>RawNoteBlock = @StartList:a</p>

<pre>( !@BlankLine OptionallyIndentedLine:l { a &lt;&lt; l } )+
( &lt; @BlankLine* &gt; { a &lt;&lt; text } )
{ a }</pre>

<p># Markdown extensions added by <a href="../../RDoc.html">RDoc</a> follow</p>

<p>CodeFence = &amp;{ github? }</p>

<pre>Ticks3 (@Sp StrChunk:format)? Spnl &lt; (
  ( !&quot;`&quot; Nonspacechar )+ |
  !Ticks3 /`+/ |
  Spacechar |
  @Newline
)+ &gt; Ticks3 @Sp @Newline*
{ verbatim = RDoc::Markup::Verbatim.new text
  verbatim.format = format.intern if format
  verbatim
}</pre>

<p>DefinitionList = &amp;{ definition_lists? }</p>

<pre>( DefinitionListItem+:list )
{ RDoc::Markup::List.new :NOTE, *list.flatten }</pre>

<p>DefinitionListItem = ( DefinitionListLabel+ ):label</p>

<pre class="ruby">( <span class="ruby-constant">DefinitionListDefinition</span><span class="ruby-operator">+</span> )<span class="ruby-operator">:</span><span class="ruby-identifier">defns</span>
{ <span class="ruby-identifier">list_items</span> = []
  <span class="ruby-identifier">list_items</span> <span class="ruby-operator">&lt;&lt;</span>
    <span class="ruby-constant">RDoc</span><span class="ruby-operator">::</span><span class="ruby-constant">Markup</span><span class="ruby-operator">::</span><span class="ruby-constant">ListItem</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">label</span>, <span class="ruby-identifier">defns</span>.<span class="ruby-identifier">shift</span>)

  <span class="ruby-identifier">list_items</span>.<span class="ruby-identifier">concat</span> <span class="ruby-identifier">defns</span>.<span class="ruby-identifier">map</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">defn</span><span class="ruby-operator">|</span>
    <span class="ruby-constant">RDoc</span><span class="ruby-operator">::</span><span class="ruby-constant">Markup</span><span class="ruby-operator">::</span><span class="ruby-constant">ListItem</span>.<span class="ruby-identifier">new</span> <span class="ruby-keyword">nil</span>, <span class="ruby-identifier">defn</span>
  } <span class="ruby-keyword">unless</span> <span class="ruby-identifier">list_items</span>.<span class="ruby-identifier">empty?</span>

  <span class="ruby-identifier">list_items</span>
}
</pre>

<p>DefinitionListLabel = StrChunk:label @Sp @Newline</p>

<pre>{ label }</pre>

<p>DefinitionListDefinition = @NonindentSpace “:” @Space Inlines:a @BlankLine+</p>

<pre>{ paragraph a }</pre>

</div>



<footer id="validator-badges">
  <p><a href="http://validator.w3.org/check/referer">[Validate]</a>
  <p>Generated by <a href="https://github.com/rdoc/rdoc">RDoc</a> 4.0.0.
  <p>Generated with the <a href="http://deveiate.org/projects/Darkfish-Rdoc/">Darkfish Rdoc Generator</a> 3.
</footer>

